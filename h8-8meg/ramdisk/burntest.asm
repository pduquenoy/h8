
	TITLE	'BURNTEST - BURN PATTERN INTO FLASH SECTOR 0'
	EJECT
***	BURNTEST - BURN PATTERN INTO FLASH SECTOR 0
*
*       SMBAKER

	XTEXT	HOSDEF
	XTEXT	HOSEQU
	XTEXT   PGREG

	LON	C

	ORG	08000H		Make sure we have room to map two pages

ENTRY	LXI	H,INTRO
	SCALL	.PRINT
	CALL	PGINIT

	DI
	MVI	A,080H
	OUT	RD00K,A
	MVI	A,083H
	OUT	RD00KH,A

	LXI	H,000H
	MOV	A,M
	INR	A
	STA	V1		INCREMENET V1 BY 1
	INX	H
	MOV	A,M
	INR	A
	INR	A
	STA	V2		INCREMENT V2 BY 2
	INX	H
	MOV	A,M
	INR	A
	INR	A
	INR	A
	STA	V3		INCREMENT V3 BY 3
	MVI	A,080H
	OUT	RD00KH,A
	MVI	A,000H
	OUT	RD00K,A
	EI

	LXI	H,000H		4K BLOCK 0
	CALL	FMAP		HL=offset, D=page

	MVI	C,003H		BANK 3
	CALL	FERASE

	LXI	H,000H		4K BLOCK 0
	CALL	FMAP		HL=offset, D=page

	LDA	V1
	MVI	C,003H		BANK 3
	CALL	FWRITE		WRITE FLASH

	LDA	V2
	INX	H		OFFSET TO 0001H
	CALL	FWRITE		WRITE FLASH

	LDA	V3
	INX	H		OFFSET TO 0002H
	CALL	FWRITE		WRITE FLASH

FINISH	LXI	H,MDONE
	SCALL	.PRINT

	XRA	A
	SCALL	.EXIT

	XTEXT	PGMAP
	XTEXT	FLASH
	XTEXT	PRHEX

INTRO	DB	12Q,'BURNTEST',212Q
MDONE	DB	12Q,'DONE',212Q

V1	DB	0
V2	DB	0
V3	DB	0

	LON	G
	END	ENTRY
